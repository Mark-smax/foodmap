<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org/">
<head>
  <meta charset="UTF-8">
  <title>我的通知</title>
  <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet"/>
</head>
<body>
<div th:replace="~{layout/navbar}"></div>

<div class="container my-4">
  <h3>通知</h3>

  <div th:if="${#lists.isEmpty(items)}" class="alert alert-info">目前沒有通知。</div>

  <div th:if="${!#lists.isEmpty(items)}" class="list-group">
    <a class="list-group-item list-group-item-action d-flex justify-content-between align-items-start"
       th:each="n : ${items}">
      <div class="ms-2 me-auto">
        <div class="fw-semibold" th:text="${n.title}">標題</div>
        <div class="text-muted small" th:text="${#temporals.format(n.createdAt, 'yyyy-MM-dd HH:mm')}"></div>
        <div th:text="${n.message}"></div>
        <a th:if="${n.link}" th:href="${n.link}" class="small">前往查看</a>
      </div>
      <div class="text-end">
        <span class="badge" th:classappend="${n.read} ? 'bg-secondary' : 'bg-primary' "
              th:text="${n.read} ? '已讀' : '未讀'"></span>
        <button class="btn btn-sm btn-outline-secondary ms-2"
                th:if="${!n.read}" th:attr="data-id=${n.id}"
                onclick="markRead(this)">標記已讀</button>
      </div>
    </a>
  </div>
</div>

<script>
  async function markRead(btn){
    const id = btn.getAttribute('data-id');
    await fetch(`/notifications/${id}/read`, { method: 'POST' });
    location.reload();
  }
</script>
</body>
</html>
