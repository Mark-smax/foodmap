<!DOCTYPE html>
<html lang="zh-Hant" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>新增餐廳</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .time-row{display:flex;gap:.5rem;align-items:center;margin-bottom:.5rem}
    .time-row .form-control,.time-row .form-select{width:auto}
  </style>
</head>
<body class="container py-4">
  <div th:replace="~{layout/navbar}"></div>

  <h2 class="mb-4">新增餐廳資料（管理員）</h2>

  <form th:action="@{/admin/restaurant/createPost}" method="post" enctype="multipart/form-data">

    <!-- 基本資料 -->
    <div class="mb-3">
      <label class="form-label">店名</label>
      <input type="text" class="form-control" name="name" required>
    </div>

    <div class="mb-3">
      <label class="form-label">地址</label>
      <input type="text" class="form-control" name="address" required>
    </div>

    <div class="mb-3">
      <label class="form-label">電話</label>
      <input type="text" class="form-control" name="phone">
    </div>

    <div class="mb-3">
      <label class="form-label">縣市</label>
      <select class="form-select" name="county" required>
        <option value="">請選擇</option>
        <option>台北市</option><option>新北市</option><option>基隆市</option>
        <option>桃園市</option><option>新竹市</option><option>新竹縣</option>
        <option>苗栗縣</option><option>台中市</option><option>彰化縣</option>
        <option>南投縣</option><option>雲林縣</option><option>嘉義市</option>
        <option>嘉義縣</option><option>台南市</option><option>高雄市</option>
        <option>屏東縣</option><option>台東縣</option><option>花蓮縣</option>
        <option>宜蘭縣</option><option>澎湖縣</option><option>金門縣</option>
        <option>連江縣</option>
      </select>
    </div>

    <div class="mb-3">
      <label class="form-label">分類（可複選）</label><br>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="checkbox" name="type" value="早餐">
        <label class="form-check-label">早餐</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="checkbox" name="type" value="早午餐">
        <label class="form-check-label">早午餐</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="checkbox" name="type" value="午餐">
        <label class="form-check-label">午餐</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="checkbox" name="type" value="下午茶">
        <label class="form-check-label">下午茶</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="checkbox" name="type" value="小吃">
        <label class="form-check-label">小吃</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="checkbox" name="type" value="晚餐">
        <label class="form-check-label">晚餐</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="checkbox" name="type" value="甜點">
        <label class="form-check-label">甜點</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="checkbox" name="type" value="冰品">
        <label class="form-check-label">冰品</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="checkbox" name="type" value="銅板美食">
        <label class="form-check-label">銅板美食</label>
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label">關鍵字 必填 方便使用者搜尋 （用空格分隔，例如：小籠包 餡餅 排隊）</label>
      <input type="text" class="form-control" name="keywords" placeholder="輸入關鍵字，如：小籠包 餡餅 排隊美食" required>
    </div>

    <div class="mb-3">
      <label class="form-label">店家照片（最多 5 張）</label>
      <input type="file" class="form-control" name="photos" multiple accept="image/*">
    </div>

    <!-- ========= 營業時間 ========= -->
    <hr class="my-4">
    <h5 class="mb-2">營業時間</h5>
    <p class="text-muted">同一天可新增多段；勾選「公休」則忽略時間。</p>

    <div id="weekly-container">
      <!-- 預設 7 行（週一 ~ 週日） -->
      <div class="time-row" th:each="i : ${#numbers.sequence(1,7)}">
        <select name="dayOfWeek" class="form-select">
          <option th:value="MONDAY"    th:selected="${i==1}">週一</option>
          <option th:value="TUESDAY"   th:selected="${i==2}">週二</option>
          <option th:value="WEDNESDAY" th:selected="${i==3}">週三</option>
          <option th:value="THURSDAY"  th:selected="${i==4}">週四</option>
          <option th:value="FRIDAY"    th:selected="${i==5}">週五</option>
          <option th:value="SATURDAY"  th:selected="${i==6}">週六</option>
          <option th:value="SUNDAY"    th:selected="${i==7}">週日</option>
        </select>

        <label>開</label><input type="time" name="openTime" class="form-control">
        <label>關</label><input type="time" name="closeTime" class="form-control">

        <!-- hidden + checkbox：確保陣列長度對齊 -->
        <input type="hidden" name="closedAllDay" value="false">
        <div class="form-check ms-1">
          <input class="form-check-input" type="checkbox" name="closedAllDay" value="true" onchange="toggleRow(this)">
          <label class="form-check-label">公休</label>
        </div>

        <button type="button" class="btn btn-sm btn-outline-secondary ms-2" onclick="addRow(this)">新增一段</button>
        <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeRow(this)">刪除</button>
      </div>
    </div>

    <div class="mt-4">
      <button type="submit" class="btn btn-primary">新增餐廳</button>
    </div>
  </form>

<script>
function addRow(btn){
  const row=btn.closest('.time-row'); const clone=row.cloneNode(true);
  // 清空時間與取消勾選
  clone.querySelectorAll('input[type=time]').forEach(i=>{i.value='';i.disabled=false;});
  // 重置 hidden+checkbox
  const cbs=clone.querySelectorAll('input[name=closedAllDay]');
  cbs.forEach((el,idx)=>{
    if(idx===0){el.type='hidden';el.value='false';}
    else{el.type='checkbox';el.checked=false;}
  });
  row.parentNode.appendChild(clone);
}
function removeRow(btn){
  const container=document.getElementById('weekly-container');
  const rows=container.querySelectorAll('.time-row');
  if(rows.length>1) btn.closest('.time-row').remove();
}
function toggleRow(cb){
  const row=cb.closest('.time-row');
  const times=row.querySelectorAll('input[type=time]');
  if(cb.checked){ times.forEach(i=>{i.value='';i.disabled=true;}); }
  else{ times.forEach(i=>i.disabled=false); }
}
</script>
</body>
</html>
